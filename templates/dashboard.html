{{define "content"}}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>{{T "WelcomeToVault"}}</h1>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="showChangePasswordModal()">{{T "ChangePassword"}}</button>
            <button class="btn btn-secondary" onclick="showImportModal()">{{T "ImportCSV"}}</button>
            <button class="btn btn-primary" onclick="showAddModal()">{{T "AddPassword"}}</button>
        </div>
    </div>

    <div class="password-grid" hx-get="/passwords" hx-trigger="load, passwordChanged from:body">
        <div class="loading">{{T "LoadingPasswords"}}</div>
    </div>
</div>

<!-- Add Password Modal -->
<div id="add-password-modal" class="modal">
    <div class="modal-content">
        <h2>{{T "AddNewPassword"}}</h2>
        <form hx-post="/passwords/add" hx-swap="none">
            <div class="form-group">
                <label>{{T "SiteService"}}</label>
                <input type="text" name="site" required placeholder="{{T " EGGoogle"}}">
            </div>
            <div class="form-group">
                <label>{{T "Username"}}</label>
                <input type="text" name="username" required placeholder="{{T " EmailOrUsername"}}">
            </div>
            <div class="form-group">
                <label>{{T "Password"}}</label>
                <input type="password" name="password" required placeholder="{{T " SitePassword"}}">
            </div>
            <div class="form-group">
                <label>{{T "Notes"}}</label>
                <textarea name="notes" placeholder="{{T " OptionalNotes"}}"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="hideAddModal()">{{T "Cancel"}}</button>
                <button type="submit" class="btn btn-primary">{{T "SavePassword"}}</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Password Modal -->
<div id="edit-password-modal" class="modal">
    <div class="modal-content">
        <h2>{{T "EditPassword"}}</h2>
        <form hx-post="/passwords/update" hx-swap="none">
            <input type="hidden" name="id" id="edit-id">
            <div class="form-group">
                <label>{{T "SiteService"}}</label>
                <input type="text" name="site" id="edit-site" required>
            </div>
            <div class="form-group">
                <label>{{T "Username"}}</label>
                <input type="text" name="username" id="edit-username" required>
            </div>
            <div class="form-group">
                <label>{{T "Password"}}</label>
                <input type="password" name="password" id="edit-password" required placeholder="{{T " SitePassword"}}">
            </div>
            <div class="form-group">
                <label>{{T "Notes"}}</label>
                <textarea name="notes" id="edit-notes" placeholder="{{T " OptionalNotes"}}"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="hideEditModal()">{{T "Cancel"}}</button>
                <button type="submit" class="btn btn-primary">{{T "UpdatePassword"}}</button>
            </div>
        </form>
    </div>
</div>

<!-- Change Password Modal -->
<div id="change-password-modal" class="modal">
    <div class="modal-content">
        <h2>{{T "ChangeAccountPassword"}}</h2>
        <form hx-post="/change-password" hx-swap="none"
            hx-on::after-request="if(event.detail.successful) hideChangePasswordModal()">
            <div class="form-group">
                <label>{{T "NewPassword"}}</label>
                <input type="password" name="new_password" required placeholder="{{T " EnterPassword"}}">
            </div>
            <div id="password-error" class="error"></div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="hideChangePasswordModal()">{{T
                    "Cancel"}}</button>
                <button type="submit" class="btn btn-primary">{{T "UpdatePassword"}}</button>
            </div>
        </form>
    </div>
</div>

<!-- Import Passwords Modal -->
<div id="import-password-modal" class="modal">
    <div class="modal-content">
        <h2>{{T "ImportChromePasswords"}}</h2>
        <p style="margin-bottom: 1.5rem; color: var(--text-muted);">{{T "ImportInstructions"}}</p>
        <form hx-post="/passwords/import" hx-encoding="multipart/form-data" hx-swap="none"
            hx-on::after-request="if(event.detail.successful) { hideImportModal(); htmx.trigger('body', 'passwordChanged'); }">
            <div class="form-group">
                <input type="file" name="csv_file" accept=".csv" required>
            </div>
            <div id="import-error" class="error"></div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="hideImportModal()">{{T "Cancel"}}</button>
                <button type="submit" class="btn btn-primary">{{T "ImportNow"}}</button>
            </div>
        </form>
    </div>
</div>

<script>
    function showImportModal() {
        document.getElementById('import-password-modal').style.display = 'flex';
    }
    function hideImportModal() {
        document.getElementById('import-password-modal').style.display = 'none';
        document.getElementById('import-error').innerText = '';
    }
    function showAddModal() {
        document.getElementById('add-password-modal').style.display = 'flex';
    }
    function hideAddModal() {
        document.getElementById('add-password-modal').style.display = 'none';
    }
    function showEditModal(id, site, username, notes) {
        document.getElementById('edit-id').value = id;
        document.getElementById('edit-site').value = site;
        document.getElementById('edit-username').value = username;
        document.getElementById('edit-notes').value = notes;
        document.getElementById('edit-password-modal').style.display = 'flex';
    }
    function hideEditModal() {
        document.getElementById('edit-password-modal').style.display = 'none';
    }
    function showChangePasswordModal() {
        document.getElementById('change-password-modal').style.display = 'flex';
    }
    function hideChangePasswordModal() {
        document.getElementById('change-password-modal').style.display = 'none';
    }

    document.body.addEventListener('passwordUpdated', function () {
        alert('{{T "PasswordUpdatedSuccessfully"}}');
    });
</script>
{{end}}